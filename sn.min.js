$(document).ready(function(){function n(){$.ajax({type:"POST",url:"process/show_notifications.php",cache:!0,dataType:"json",success:function(n){if(sessionStorage.setItem("records",n.count),$(".notification-list").html(n.template),$("#notification_icon").addClass(n.animate),n.count>=1){var t=n.count;$(".notification-count").html("<span id='child' class='lh-1'>"+t+"</span>"),$(".notification-count").removeClass("d-none"),$(".notification-count").addClass("badge bg-danger border border-4 border-primary position-absolute rounded-pill start-100 translate-middle"),$(".notification-mark-all").removeClass("d-none"),$(".notification-trigger").each(function(){$(this).click(function(){var n=$(this).siblings(".notification-nid").val();$.ajax({type:"POST",url:"process/read_notification.php",cache:!0,data:{nid:n},success:function(){}})})})}else $(".notification-count").addClass("d-none"),$(".notification-mark-all").addClass("d-none");$(".timeago").timeago(),$(".remove-notification-btn").each(function(){$(this).click(function(n){n.stopPropagation(),n.preventDefault();var t=$(this).prev("#notification_id").val();$.ajax({type:"POST",url:"process/remove_notification.php",cache:!1,data:{nid:t},success:function(n){},error:function(n,t,o){alert(n.responseText)}})})})},error:function(n,t,o){alert(n.responseText)}})}const t=new MutationObserver(function(n){n.forEach(function(n){n.addedNodes.forEach(function(n){"child"==n.id&&(console.log("New Notification"),new Audio("https://cdn.jsdelivr.net/gh/Winchester316/js@latest/notication_sound.mp3").play(),t.disconnect())})})});t.observe(document.querySelector(".notification-count"),{subtree:!1,childList:!0}),setInterval(function(){n()},1e3),$(".notification-mark-all").click(function(n){n.stopPropagation(),n.preventDefault(),$.ajax({type:"POST",url:"process/mark_all_notifications.php",cache:!0,data:{data:"mark_all"},beforeSend:function(){$(".notification-mark-all").html('<span class="spinner-border spinner-border-sm text-decoration-none" role="status" aria-hidden="true"></span> Processing...')},complete:function(){$(".notification-mark-all").html("Mark all as read")},success:function(){$.ajax({type:"POST",url:"process/check_new_notifications.php",cache:!0,dataType:"json",success:function(n){sessionStorage.setItem("notification_count",n.count)}})},error:function(n,t,o){alert(n.responseText)}})})});
